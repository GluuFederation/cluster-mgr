Ubuntu 14:
  tasks: &U14Tasks
    - name: restart redis
      command: service redis-server restart
    - name: restart stunnel
      command: service stunnel4 restart
    - name: restart oxAuth
      command: service oxauth restart
      env: chroot
    - name: restart oxTrust (identity)
      command: service identity restart
      env: chroot
    - name: restart Apache 2
      command: service apache2 restart
      env: chroot
  envs: &U14Envs
    - name: chroot
      wrapper: chroot {chdir} /bin/bash -c "{command}"
      requires: chdir

Ubuntu 16:
  tasks: *U14Tasks
  envs: *U14Envs

CentOS 6:
  tasks: &C6
    - name: restart redis
      command: service redis restart
    - name: restart stunnel
      command: service stunnel4 restart
    - name: restart oxAuth
      command: service oxauth restart
      prefix: chroot
    - name: restart oxTrust (identity)
      command: service identity restart
      prefix: chroot
    - name: restart Apache 2
      command: service apache2 restart
      prefix: chroot
  envs: *U14Envs

# The tasks are the same as CentOS 6. But due to the systemctl handling of
# services, the prefix is changed
CentOS 7:
  tasks: *C6
  envs:
    - name: chroot
      wrapper: ssh -o IdentityFile=/etc/gluu/keys/gluu-console -o Port=60022 -o LogLevel=QUIET -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o PubkeyAuthentication=yes root@localhost "{command}"
