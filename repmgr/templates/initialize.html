{% extends "base.html" %}
{% block  content %}
<h2>Initializing server  {{ server.hostname }}</h2>
<div class="progress">
  <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
    <span class="sr-only"></span>
  </div>
</div>
<ul class="list-group">
  <li id="conn" class="list-group-item">
    Connecting to the server {{ server.hotname }}:{{ server.port }} ...
    <span class="pull-right text-success" style="display: none"><i class="glyphicon glyphicon-ok"></i></span>
    <span class="pull-right text-danger" style="display: none"><i class="glyphicon glyphicon-remove"></i></span>
  </li>
  <li id="add" class="list-group-item">
    Adding the replicaiton user to the server ...
    <span class="pull-right text-success" style="display: none"><i class="glyphicon glyphicon-ok"></i></span>
    <span class="pull-right text-danger" style="display: none"><i class="glyphicon glyphicon-remove"></i></span>
  </li>
  </li>
  <li id="recon" class="list-group-item">
    Reconnecting and verifying authentication as the replication user ...
    <span class="pull-right text-success" style="display: none"><i class="glyphicon glyphicon-ok"></i></span>
    <span class="pull-right text-danger" style="display: none"><i class="glyphicon glyphicon-remove"></i></span>
  </li>
  </li>
</ul>

<script>
var task_id = "{{ task.id }}";
var tid;
function updateLog(){
    $.get('{{ url_for("task_status", task_id=task.id) }}', function(data){
        var steps = ['conn', 'add', 'recon'];
        for(var i=0; i<steps.length; i++){
            var k = steps[i];
            if(data[k] == 'success'){
                $('#'+k+' > span.text-success').show();
            } else if (data[k] == 'failed'){
                $('#'+k+' > span.text-danger').show();
            }
            if(data.recon == 'failed' || data.recon == 'success'){clearInterval(tid);}
        }
    });
}
tid = setInterval(updateLog, 1000);
</script>
{% endblock %}
